<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Single Recipe</title>
	<!--[if IE]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>

<body id="home">

  <h2>viewing {{ object.title }}</h2>
  <p>
    Added on {{ object.pub_date | date:"M d, Y" }} by <a href="{% url 'chef:chef' usrname=recipe.author.username %}">{{ object.author }}</a>
  </p>
  
  <p>Prep Time: {{ object.prepTime }}</p>
  <p>Cook Time: {{ object.cookTime }}</p>
  <p>Total Time: {{ object.totalTime }}</p>
  
  <h4>yields {{ object.yieldAmt }}</h4>
  
  <div id="ingredients">
    <p>Ingredients</p>
    <ul>
    {% for key, value in ingredList %}
      <li>{{ key }} : {{ value }}</li>
    {% endfor %}
    </ul>
  </div>
  
    <div id="methods">
    <p>Method</p>
    <ul>
    {% for key, value in methodList %}
      <li>{{ key }} : {{ value }}</li>
    {% endfor %}
    </ul>
  </div>
  
  {% if object.notes %}
    <p>notes : {{ object.notes }}</p>
  {% endif %}
  
  
  <h3>Tags</h3>
  <ul>
    {% for tag in object.tags.all %}
    <li>
      <a href="{% url 'myrecipe:search' %}?recipeQuery={{ tag.name }}">{{ tag.name }}</a>
    </li>
    {% endfor %}
  </ul>
  
  <br>
  
  <input id="numLikes" value="{{ object.likes.count }}"></input> <p>likes</p>
 
  <br>
  
  {% if user.is_authenticated %}
    <form action="." method="POST">
    {% csrf_token %}
    <input type="button" id="like" data-slug="{{ object.slug }}" value="Like">
    </form>
  {% endif %}
  
  
  <br>

  {% if user.is_authenticated %}
    {% ifequal user object.author %}
      <a href="{% url 'myrecipe:edit' recipe.slug %}">Edit</a>
      <a href="{% url 'myrecipe:deleteRecipe' recipe.slug %}">Delete</a>
    {% endifequal %}
  {% endif %}
  
  
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    function ajaxLike(){
      $('#like').click(function(){
        $.ajax({
          type:     "POST",
          url:      "/like/",
          data:     {'slug': $('#like').attr('data-slug')},
          dataType: 'json',
          headers: {
          'X-CSRFToken': $.cookie('csrftoken')
          },
          success: function(data, textstatus, jqXHR){
          console.log("success!");
          console.log(data);
          console.log(textstatus);
          console.log(data.responseText);
          //window.location = data['redirectUrl'];
          console.log(data.msg);
          
          if(data.liked){
            $('#numLikes').val(parseInt($('#numLikes').val()) + 1);
            $('#like').val('liked');
            $('#like').css('border-color', 'green');
          }
          else if(!data.liked)
            //$('#like').css('border, 1px solid green');
            if ($('#numLikes').val() > 0)
              $('#numLikes').val(parseInt($('#numLikes').val()) - 1);
          },
          error: function(data, textstatus, jqXHR){
          console.log("error!");
          console.log(data);
          console.log(textstatus);
          console.log(data.responseText);
          window.sdata = data;
          
          console.log(data.msg);
        }
        });
      });
    }
    
    
    $(document).ready(function(){
      ajaxLike();
    });
  </script>
  

</body>
</html>