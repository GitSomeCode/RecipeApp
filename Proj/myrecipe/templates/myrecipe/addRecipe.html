{% extends 'myrecipe/_base.html' %}
{% load staticfiles %}

{% block title %}Add Recipe{% endblock %}

<!-- <body id="home"> -->
{% block main %}
<div class="container">
   <div class="row">
     <div class="col-md-12">
    <ul class="nav nav-tabs">
      <li><a href="{% url 'chef:dashboard' %}">Dashboard</a></li>
      <li class="active"><a href="{% url 'chef:chefRecipes' %}">My Recipes</a></li>
      <li><a href="{% url 'chef:chefFavorites' %}">My Favorites</a></li>
      {% if ifLikedByAny %}
      <li><a href="{% url 'chef:wholiked' %}">Who Liked</a></li>
      {% endif %}
    </ul>
     </div>
     </div>

     <div class="row">
     <div class="col-md-12">
    <ul class="nav nav-pills">
      <li><a href="{% url 'chef:chefRecipes' %}">All Recipes</a></li>
      <li class="active"><a href="#">Add Recipe</a></li>
      <li><a href="{% url 'myrecipe:modify' %}">Modify Recipe</a></li>
    </ul>
     </div>
      </div>
  </div>


  <div class="container">
  <div class="row">
  <div class="col-md-12 text-center">
	<h1>Add a recipe!</h1>
  <form id="recipeform" action="{% url 'myrecipe:newRecipeData' %}" method="POST">
    {% csrf_token %}
    
    <div id="title-error"></div>
    <p  class="formtitles">Title</p> <input id="title" type="text" name="title">
    
    <div id="yieldAmt-error"></div>
    <p  class="formtitles">yields</p> <input id="yieldAmt" type="number" min="1" name="yieldAmt">
    
    <!--
    <div id="ingredients-error"></div>
    <p  class="formtitles">Ingredients</p> <input id="ingredients" type="text" name="ingredients">
    
    <div id="method-error"></div>
    <p  class="formtitles">Method</p> <input id="method" type="text" name="method">
    -->
    
    <!-- NEW INGREDIENTS AND METHOD CODE -->
    <div id="ingredients-error"></div>
    <p class="formtitles">Ingredients</p> 
    <div id="ingredients">
      <input type="button" id="addIn" value="+"> <br> 
      <input type="text" id="firstIn" class="ingredientsField" name="ingredients" required><br>
    </div>
    
    
    <div id="method-error"></div>
    <p class="formtitles">Method</p> 
    <div id="methods">
      <input type="button" id="addMd" value="+"> <br> 
      <input type="text" id="firstMd" class="methodsField" name="method" required><br>
      <input type="text" id="secondMd" class="methodsField" name="method" required><br>
    </div>
    <!-- END OF NEW CODE CHANGES -->
    
    
    
    <div id="prepTime-error"></div>
    <p  class="formtitles">Prep Time</p> <input id="prepTime" type="number" min="1" name="prepTime">
    
    <div id="cookTime-error"></div>
    <p  class="formtitles">Cook Time</p> <input id="cookTime" type="number" name="cookTime">
    
    <div id="notes-error"></div>
    <p  class="formtitles">Notes</p> <input id="notes" type="text" name="notes">
    
    <div id="tags-error"></div>
    <p  class="formtitles">tags</p> <input id="tags" type="text" name="tags"> <br>
    <input type="submit" value="submit">
  </form>
  
  
  </div>
    </div>
    </div>


{% endblock %}
  
  
{% block scripts %}
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    function callingAjax(){
      $.ajax({
        url: "/new/",
        type: 'POST',
        dataType: 'json',
        headers: {
          'X-CSRFToken': $.cookie('csrftoken')
        },
        data: {
          'title'       :$('#title').val(),
          'yieldAmt'    :$('#yieldAmt').val(),
          //'ingredients' :$('#ingredients').val(),
          //'method'      :$('#method').val(),
          'ingredients' : ingredientsJSON,
          'method'      : methodsJSON,
          'prepTime'    :$('#prepTime').val(),
          'cookTime'    :$('#cookTime').val(),
          'notes'       :$('#notes').val(),
          'tags'        :$('#tags').val()
        },
        success: function(data, textstatus, jqXHR){
          console.log("success!");
          console.log(data);
          console.log(textstatus);
          console.log(data.responseText);
          window.location = data['redirectUrl'];
        },
        error: function(data, textstatus, jqXHR){
          console.log("error!");
          console.log(data);
          console.log(textstatus);
          
          console.log(data.responseText);
          window.wtf = data;
          errorIterate(data);
        }
      });
    }
    
    function popu(){
      $('#title').val('Oatmeal Cookies'),
      $('#yieldAmt').val(12),
      //$('#ingredients').val(JSON.stringify({1:'oats', 2:'pb'})),
      //$('#method').val(JSON.stringify({1:'mix', 2:'bake'})),
      $('#prepTime').val(15),
      $('#cookTime').val(20),
      $('#notes').val('Add chocolate chips'),
      $('#tags').val('healthy, cookies, oats')
    }
    
    function errorIterate(data){
      _.each(data.responseJSON, function(value, key){
        // value is going to be an array
        
          // iterate through value list of responseJSON object
          _.each(value, function(element, index){
            $('<p>', {
              text: element
            }).appendTo('#' + key + "-error");
          });
      });
    }
    
    // INGREDIENTS AND METHOD FUNCTIONS
    function addField(id){
      $('#'+id).append("<div><input type='text' class='" + id + "Field' required><button class='delete'>remove</button></div>");
    }
  
    function deleteField(id){
      $(id).on('click', '.delete', function(e){
        $(this).parent('div').remove();
      });
    }
 
    function gatherData(id){
      var JSONobject = {};
      classname = id + 'Field';
      $('input.' + classname).each(function(index){
        JSONobject[index+1] = $(this).val();
        console.log(JSONobject[index+1]);
      });
      return JSONobject;
    }
    
    
    var ingredientsJSON;
    var methodsJSON;
    // END OF INGREDIENTS AND METHOD FUNCTIONS
    
    $(document).ready(function(){
      
      popu();
      
      // NEW STUFF
      $('#addIn').click(function(e){
        addField('ingredients');
      });
    
      $('#addMd').click(function(e){
        addField('methods');
      });
    
      deleteField('#ingredients');
      deleteField('#methods');
    
      
      $("#recipeform").submit(function(event){
        event.preventDefault();
        
        
        ingredientsJSON = gatherData('ingredients');
        methodsJSON = gatherData('methods');
      
        
        ingredientsJSON = JSON.stringify(ingredientsJSON);
        methodsJSON = JSON.stringify(methodsJSON);
        
        console.log(ingredientsJSON);
        console.log(methodsJSON);
      
        
        //$('#result').text(JSON.stringify(ingredientsJSON));
        //$('#result').append(JSON.stringify(methodsJSON));
        // END OF NEW STUFF
        
        
        callingAjax();
       
      })
      
      
    });
  </script>
{% endblock %}
  
<!-- </body>
</html> -->